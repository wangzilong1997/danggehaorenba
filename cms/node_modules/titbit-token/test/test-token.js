'use strict'

const token = require('../token')

const tok = new token({
  urlencoded : true
})

//tok.setExpires(1)

tok.setEncoding('base64')

let tidlist = ['t1','t2','t3','t4']

tok.addTokenId(tidlist)

tok.setMapId('tit')

let info = {
  id : 1001,
  //name : 'brave'
}

let edata = tok.make(info)

let realData = tok.verify(edata)

console.log(edata)
console.log(realData)

let edataList = []

for (let i = 0 ; i < 10; i++) {
  edata = tok.make(info)
  edataList.push(edata)
}

if ( parseInt(Math.random() * 10) > 5 ) {
  tok.removeTokenId('t2')
  tok.removeTokenId('t3')
}

for (let i = 0; i < 10; i++) {
  realData = tok.verify(edataList[i])
  console.log(realData)
}

edata = tok.make(info, 'tit')

console.log(tok.verify(edata))

let total = 10000

tok.setIdKeyIv('xyz','qazxswedcfvrgthynujmkiolp0987654', 'qawsedrftgyhujik')
tok.setIdKeyIv('io', 'qazxswedcfvrgthynujmkiolp0e24565', 'qawsedrftgyhujik')
tok.setIdKeyIv('cd', 'qazxswedcfvrgthynujmkiolpr5tf765', 'qawsedrftgyhujie')
tok.setIdKeyIv('mk', 'qazxswedcfvrgthynujmkiolpw347f65', 'qawsedrftgyhujir')

let ikv = {
  id : 'io',
  key : 'qazxswedcfvrgthynujmkiolp0e24565',
  iv : 'qawsedrftgyhujik'
}
edata = tok.makeikv(info, ikv)

realData = tok.verifyikv(edata, ikv)

console.log('--IKV-TEST--:', edata, realData)

let st = Date.now()

for (let i = 0; i < total; i++) {
  //edata = tok.make(info, 'xyz')
  //realData = tok.verify(edata, 'qazxswedcfvrgthynujmkiolp0987654', 'qawsedrftgyhujik', 'xyz')
  //realData = tok.verifyId(edata, 'xyz')
  
  //edata = tok.make(info, 'io')
  //realData = tok.verifyid(edata, 'io')
  //console.log(edata, realData)

  edata = tok.randIvToken(info)
  realData = tok.verifyikv(edata.token, edata)
  //console.log(edata, realData)
}

let et = Date.now()

console.log(et - st, 'ms')

console.log(tok.randIvToken(info))